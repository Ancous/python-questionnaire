{% extends "base.html" %}
{% block content %}
<main>
    {% if authorization %}
    <div>
        Осталось {{ number_questions_answered }} из 200 случайных вопросов
    </div>
    {% else %}
    <div>
        Чтобы сохранялась история вопросов нужна авторизация
    </div>
    {% endif %}
    {% with messages = get_flashed_messages(category_filter=["login"]) %}
    {% for message in messages %}
    <div class="flash-message">
        {{ message }}
    </div>
    {% endfor %}
    {% endwith %}
    <h2>
        Войти
    </h2>
    <div>
        <button onclick="window.location.href='{{ url_for('main.main') }}'">
            Вернуться на главную
        </button>
    </div>
    <div>
        <form method="post">
            {{ form.hidden_tag() }}
            <p>
                {{ form.username.label }}
                <br>
                {{ form.username(class="validate") }}
                {% for error in form.username.errors %}
                <span class="error-message" style="color: red;">{{ error }}</span>
                {% endfor %}
            </p>
            <p>
                {{ form.password.label }}
                <br>
                {{ form.password(class="validate") }}
                {% for error in form.username.errors %}
                <span class="error-message" style="color: red;">{{ error }}</span>
                {% endfor %}
            </p>
            <p>
                {{ form.submit() }}
            </p>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input.validate').forEach(function(input) {
                input.addEventListener('input', function() {
                    // Получаем родительский <p> и все error-message внутри него
                    let p = input.closest('p');
                    if (!p) return;
                    let errors = p.querySelectorAll('.error-message');
                    if (input.value.trim() !== '') {
                        errors.forEach(span => span.style.display = 'none');
                    } else {
                        errors.forEach(span => span.style.display = 'inline');
                    }
                });
            });
        });
    </script>
</main>
{% endblock %}
