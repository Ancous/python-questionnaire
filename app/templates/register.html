{% extends "base.html" %}
{% block content %}
<main>
    {% with messages = get_flashed_messages(category_filter=["register"]) %}
    {% for message in messages %}
    <div class="flash-message">
        {{ message }}
    </div>
    {% endfor %}
    {% endwith %}
    <h2 class="header-h2">
        Регистрация
    </h2>
    <div class="button-container">
        <button class="button" onclick="window.location.href='{{ url_for('main.main') }}'">
            Вернуться на главную
        </button>
    </div>
    <div class="register-form">
        <form method="post">
            {{ form.hidden_tag() }}
            <p>
                {{ form.username.label }}
                <br>
                {{ form.username(size=28, class="validate") }}
                {% for error in form.username.errors %}
                <span class="error-message">{{ error }}</span>
                {% endfor %}
            </p>
            <p>
                {{ form.password.label }}
                <br>
                {{ form.password(size=28, class="validate") }}
                {% for error in form.password.errors %}
                <span class="error-message">{{ error }}</span>
                {% endfor %}
            </p>
            <p>
                {{ form.confirm.label }}
                <br>
                {{ form.confirm(size=28, class="validate") }}
                {% for error in form.confirm.errors %}
                <span class="error-message">{{ error }}</span>
                {% endfor %}
            </p>
            <p>
                {{ form.submit(class="button") }}
            </p>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input.validate').forEach(function(input) {
                input.addEventListener('input', function() {
                    // Получаем родительский <p> и все error-message внутри него
                    let p = input.closest('p');
                    if (!p) return;
                    let errors = p.querySelectorAll('.error-message');
                    if (input.value.trim() !== '') {
                        errors.forEach(span => span.style.display = 'none');
                    } else {
                        errors.forEach(span => span.style.display = 'inline');
                    }
                });
            });
        });
    </script>
</main>
{% endblock %}
